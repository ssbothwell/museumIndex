<% title "Museum" %>

<div class="museum">
  <%= image_tag @museum.photo.url(:small) %>
  <br />

<p>
  <strong>Name:</strong>
  <%=h @museum.name %><br />
  <strong>Location:</strong>
  <%=h @museum.location %><br />
  <strong>Telephone:</strong>
  <%=h number_to_phone(@museum.telephone) %>
</p>
<div id="map"></div>
</div>

  <ul><strong>Current Exhibitions:</strong>
    <% @museum.exhibitions.current.each do |l| %>
    <li><%= link_to l.title, l %></li>
    <% end %>
  </ul>  
  <ul><strong>Upcoming Exhibitions:</strong>
    <% @museum.exhibitions.upcoming.each do |l| %>
    <li><%= link_to l.title, l %></li>
    <% end %>
  </ul>

    <% 
    geo = Google::Geo.new "ABQIAAAAAQu_w3gsZDzjEayN7Mkn7BTJQa0g3IQ9GZqIMmInSLzwtGDKaBQKDrEFjkghyaYDRHlNnNpzlvjogw" 
    addresses = geo.locate @museum.location
    addresses.size
    address = addresses.first
    %>

<p>
  <%= link_to "Edit", edit_museum_path(@museum) %> |
  <%= link_to "Destroy", @museum, :confirm => 'Are you sure?', :method => :delete %> |
  <%= link_to "View All", museums_path %>
</p>
<script type="text/javascript">
  google.load("maps", "2");
  
  // Call this function when the page has been loaded
  function initialize() {
    function createMarker(point,html) {
      var marker = new GMarker(point);
      GEvent.addListener(marker, "click", function() {
        marker.openInfoWindowHtml(html);
      });
      return marker;
    }
    
    var map = new google.maps.Map2(document.getElementById("map"));
    map.setCenter(new GLatLng(<%= address.latitude %>, <%= address.longitude %>), 16);
    map.addControl(new GSmallMapControl());
    
    var point = new GLatLng(<%= address.latitude %>, <%= address.longitude %>);
    var marker = createMarker(point,'LACMA <br /> <%= address.street %><br /><%= address.city %> <%= address.state %> <%= address.zip %>')
    map.addOverlay(marker);

  }
  google.setOnLoadCallback(initialize);
  
</script>

